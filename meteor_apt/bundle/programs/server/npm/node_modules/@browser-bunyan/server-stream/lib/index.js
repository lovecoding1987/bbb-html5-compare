var e="undefined"!=typeof window?window.navigator.userAgent:"no-window",t=/bot|crawler|spider|crawling/i.test(e),r=function t(e){var r=this;void 0===e&&(e={});var o=e.method;void 0===o&&(o="PUT");var n=e.url;void 0===n&&(n="/log");var i=e.throttleInterval;void 0===i&&(i=3e3);var s=e.withCredentials;void 0===s&&(s=!1);var a=e.onError,d=e.flushOnClose;void 0===d&&(d=!1);var u=e.writeCondition;void 0===u&&(u=t.defaultWriteCondition),this.writeCondition=u,this.records={},this.start({method:o,url:n,throttleInterval:i,withCredentials:s,onError:a});var l=void 0!==typeof Blob&&window.navigator.sendBeacon;d&&l&&"POST"===o.toUpperCase()&&window.addEventListener("unload",function(){r.currentThrottleTimeout&&window.clearTimeout(r.currentThrottleTimeout);var t=r.recordsAsArray();if(t.length){var e=new Blob([JSON.stringify(t)],{type:"text/plain"});navigator.sendBeacon(n,e)}},!1)};r.prototype.start=function(t){var r=this,o=t.method,n=t.url,e=t.throttleInterval,i=t.withCredentials,s=t.onError,a=function(){r.currentThrottleTimeout=setTimeout(function(){var t=r.recordsAsArray();if(t.length){var e=new XMLHttpRequest;e.onreadystatechange=function(){e.readyState===XMLHttpRequest.DONE&&(400<=e.status&&("function"==typeof s?s.call(r,t,e):console.warn("Browser Bunyan: A server log write failed")),r.records={},a())},e.open(o,n),e.setRequestHeader("Content-Type","application/json"),e.withCredentials=i,e.send(JSON.stringify(t))}else a()},e)};a()},r.prototype.stop=function(){var t=this;setTimeout(function(){t.currentThrottleTimeout&&(clearTimeout(t.currentThrottleTimeout),t.currentThrottleTimeout=null)},1)},r.prototype.write=function(t){t.url="undefined"!=typeof window&&window.location.href,t.userAgent=e,this.currentThrottleTimeout&&this.writeCondition(t)&&(this.records[t.msg]?this.records[t.msg].count++:(t.count=1,this.records[t.msg]=t))},r.prototype.recordsAsArray=function(){var e=this;return Object.keys(this.records).map(function(t){return e.records[t]})},r.defaultWriteCondition=function(){return window.navigator.onLine&&!t},exports.ServerStream=r;
//# sourceMappingURL=index.js.map
